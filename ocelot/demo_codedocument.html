<!DOCTYPE html> <html lang="en"> <head> <meta charset="UTF-8"> <meta name="viewport" content="width=device-width, initial-scale=1"> <title>Interactive Code Document Demo</title> 

  <!--
  Interactive Code Document Demo

  - Implements a custom code document UI with XML-like tags (function, class, group, etc).
  - Supports bimodal control: mouse for navigation, keyboard for activation (key-clicks).
    - Bimodal control: A user interface theory that separates navigation (steering) and activation (triggering actions) into two distinct input devices—typically using the mouse for cursor movement and the keyboard for function activation ("key-clicks"). This division, inspired by how a guitarist uses both hands for different tasks, reduces cognitive load and increases precision and efficiency in software interaction.
  - Tracks the currently hovered element and updates a floating key command menu.
  - Selection is limited to elements at the same tree level.
  - Behaviors (selectable, draggable, etc.) are managed via a tagBehaviors dictionary.
  - Features tabbed function views, collapsible code bodies, and a calculator button grid.
  - Designed for extensibility and UI theory experimentation.
-->

<style> 
/* Base page and layout styles */ 
body { 
  font-family: monospace;
  margin: 10pt;
   background-color: #f7f7f7; 
   color: #333; } 

    /* Base display for custom XML-based code tags */
    codeDocument, group, function, class, method, name, documentation, parameters, parameter, return-type, codeBody, loop, initialization, condition, increment, variable, statement, return {
      display: block;
      margin: 0;/*0.5em 0;*/
      

    }

    html, body {
  height: 100%;
  margin: 0;
  padding: 0;
}


    
    codeDocument {
      cursor:crosshair;
  display: block;
  max-width: 1400px;
  margin: auto;
  height: 100%; /* Fill the available height */

  overflow-y: auto; /* Enable vertical scrolling */
  overflow-x: hidden; /* Prevent horizontal scrolling */
  column-count: 2;
  column-gap: 40px;
  column-rule: 4px solid gray;
  background-color: #969696;
  padding: 10pt;
  border: 1pt solid black;
}

expression{
display:inline-block
}



statement {
    border-top: 1pt solid white;
    border: 1pt solid #000000;
    /* border-bottom: 1pt solid gray; */
    background-color: #330bc4;
    padding: 4pt;
    display: inline-block;
    margin-bottom: 5pt;
    box-shadow: 2pt 2pt 1pt #000000;
}

statement name{
font-family: monospace;
font-size:11pt;
}

type, name {
  display: inline-block;

}

typename {
display:none;
}

/* Ensure return and its children are aligned horizontally */
return {
  display: flex;
  align-items: center; /* Vertically align items */
  gap: 5px; /* Add spacing between items if needed */
  
}

return > name {
    display: inline-block;
    background-color: #330bc4;
    padding: 3pt;
    border: 2pt dashed orange;
    color: red;
 
}

return > expression {
  display: inline-block;
}

group { 
  border:2pt dotted black;
  padding:10pt;
  padding-left:10pt;
  margin:4pt;
  margin-left:0;
  margin-bottom:20pt;
  background-color: #848484;
  box-shadow: 8px 8px 6px rgb(34, 34, 34);
  
}
    
    
    documentation {
        display: none;
      font-style: italic;
      color: #555;
    }
    
    typeSymbol {
    display: inline-block;
    background-color: #bbb;
    padding: 2pt;
    border-radius: 2pt;
}

parameter > typeSymbol {
        display: inline-block;

      font-family: monospace;
      background-color: #bbb;
      color: white;
      padding: 2px 4px;
      border-radius: 3px;
      margin-right: 0px;
      border:2px solid gray;

    }
    variable > type > typeSymbol {

      font-family: monospace;
      background-color: #bbb;
      color: white;
      padding: 2px 4px;
      border-radius: 3px;
      margin-right: 2px;
    }

    typeSymbol > type{
display:none;
    }
   
    typeSymbol > typeName{

    }
    
    /* --- Return Type --- */
    return-type {
      font-family: monospace;
      color: #990000;
      padding: 2px;
      background-color: #efefef;
      border-radius: 0px;
      display: inline-block;
      margin-top: 1px;
      width:14pt;
      text-align: center;
      font-size:12pt;
      
    }
    
     /* --- Function Element Styling --- */
     function {
      break-inside: avoid;
      border:4pt solid black;
      margin-bottom:20pt;
      border-radius: 5pt;
      overflow:hidden;
      box-shadow: 5px 5px 6px rgb(77, 77, 77);
      background: rgb(152, 99, 0);
      
    }

    function > name{

    }
    function:hover{
      background: rgb(216, 178, 107);

    }

    

    /* Place parameters box above function name */
    function > parameters, method > parameters {
      margin-bottom: 1px;
      background-color: black;
      
      padding: 0pt;
      padding-bottom:4pt;
      border-bottom: 2pt solid white;
    }

     /* --- Parameters and Variable Type Symbols --- */
    /* Each parameter now has a <typeSymbol> to show the leading symbol. */
      parameter {
  display: inline-block;
  margin-right: 15px;
  background-color: #aaaaaa;
  padding: 0pt;
  border: 2pt solid rgb(51, 51, 51);
  border-radius: 4pt;
  position: relative;
}

parameter:not(:last-child)::after {
  content: '•'; /* The dot separator */
  position: absolute;
  right: -11px; /* Adjust spacing */
  top: 50%;
  transform: translateY(-50%);
  color: rgb(130, 110, 241); /* Adjust color as needed */
  font-size: 12pt; /* Adjust size as needed */
}

    function > typeSymbol, method > typeSymbol
    {
color:#994f00;
    }

    functionCall > typeSymbol{
    color: #994a00;
    padding: 1pt;
    font-size: 15pt;
    background-color: rgb(232, 110, 3);


  }

  functionCall > parameters:empty {
  padding: 5pt;
height:10pt;
}


    
    parameter > type {
        

      font-family: monospace;
      color: #990000;
      background-color: transparent;
    }
  
  
    parameter > name {
            display: inline-block;

        font-family: monospace;
      color: #c0c0c0;
      background-color: #4b4b4b;
      color: #9e9e9e;
      
      margin-left: -6px;
      border:1px solid rgb(20, 20, 20);
    }

    parameter > type > typeName{
      display:none;
    }


    /* Function name styling and function symbol */
    function > name {
    font-family: Lekton, monospace;
    text-decoration: underline;
    /* font-weight: bold; */
    font-size: 15pt;
    
    color: #e9ad5f;
    padding: 2pt;
    position: relative;
    text-shadow: 2px 2px 4px rgb(93 47 9);
    transform: skewX(-10deg);
}

function > name:hover{
  color: #845920;
}



    function > name::before {
      content: 'ℱ';
      background-color: orange;
      color:#640000;
      padding: 2px 6px;
      border-radius: 3px;
      margin-right: 4px;
    }
    

    /* --- Function Body --- */
    function > codeBody, method > codeBody {
        display: block;
      
      background-color: #005599;

      border-top: 4pt solid #000000;
      /*   
      border:5px solid blue;
      border-top:5pt solid blue;
*/
      background-color: blue;

      background-color: #3737c1;
      color:white;
      padding:4pt;
      padding-top:8pt;
      margin:0;
    }
    function.collapsed > codeBody {
        display: none;
    }
    function.expanded > codeBody {
      display: block;

      border: 1px solid #ccc;
      border-radius: 10pt;
      background-color: rgb(249, 218, 160);
      padding: 10px;
    
      
    }
    
    /* --- Class and Methods --- */
    class {
  border: 1px solid #a8a8a8;
  padding: 0px;
  margin-bottom: 20px;
  break-inside: avoid;
  border-radius: 20pt;
  box-shadow: inset 4px 4px 5px rgba(0, 0, 0, 0.6), inset -4px -4px 8px rgba(255, 255, 255, 0.5);
  padding: 10pt;
}

group {
  position: relative; /* Needed to position the pseudo-element relative to the group */
}

group::after {
  content: "GROUP";
  position: absolute;
  top: 5px;
  right: 5px;
  font-size: 18px;
  color: rgba(0, 0, 0, .4); /* Light and subtle */
  pointer-events: none; /* So it doesn't interfere with clicks */
  z-index: 3; /* Places it in the background */
}


class > constructors > function{
display:block;
padding:2pt;
padding-top:5pt;
  background-color: rgb(96, 148, 148);

}
class > constructors > function > role{
background-color: rgb(104, 174, 174);
}

class > name {
    margin-bottom: 5pt;
    display: block;
    font-size: 18pt;
    color: #fff;
    font-weight: bold;
    padding-bottom: 5px;
    
    border-top-left-radius: 15pt;
    border-top-right-radius: 15pt;
    padding-left: 20pt;
    color: rgb(0, 0, 0);
    padding-top: 5pt;
    font-size: 14pt;
    border-bottom: 1pt solid white;
}

    class > name::before
    {
        content: 'ℂ ';
    }
    
    /* Methods inside class mimic function styling */
    /*
    method {
      border: 1px solid #ddd;
      padding: 10px;
      margin-top: 10px;
      background-color: #f9f9f9;
      border-radius: 8pt;
    }
    method > parameters {
      margin-bottom: 8px;
      background-color: transparent;
      padding: 4px;
    }
    method > name {
      font-family: 'Franklin Gothic Medium', 'Arial Narrow', Arial, sans-serif;
      font-size: 14pt;
      background-color: #4a4a4a;
      color: #ddd;
      padding: 6px;
      border-top-left-radius: 8pt;
      border-top-right-radius: 8pt;
      position: relative;
    }
    method > name::before {
      content: 'ℱ';
      background-color: darkslategray;
      color: white;
      padding: 2px 5px;
      border-radius: 3px;
      margin-right: 4px;
    }*/
    

    
    /* --- Standalone Variable Declaration --- */
    variable, functionCall parameter {
        display: inline-block;
      margin: 0px 0;
      font-family: monospace;
    
    color:white;    
    background-color: #000;
    padding:3pt;
    border-radius: 4pt;
}

variable > documentation{
    display: none;
}

    variable > name {
        
        display: inline-block;
        font-family: monospace;
      color: #005599;
    background-color: #aaa;
    }
    
    variable > type{
display:inline-block;
    }

   
    
    /* --- Loop Styling --- */
    loop {
      border: 1px dashed #aaa;
      padding: 5px;
      margin: 10px 0;
    }
    
    /* --- Interactivity --- */
    /* Clicking on a function or method name toggles the display of their bodies */
    function > name {
      cursor: pointer;
    }

    /* Ensure functionCall and its children are aligned horizontally */
    
    
functionCall {
  display: flex;
  align-items: center; /* Vertically align items */
  /*gap: 5px;  Add spacing between items if needed */
  background-color: rgb(213 172 96);
  border-top-right-radius: 10pt;
  border-bottom-right-radius: 10pt;
  border-top-left-radius: 10pt;
  border-bottom-left-radius: 10pt;
  padding-left: 5pt;

}

/* alt styling for function:*/

functionCall {
    display: flex;
    align-items: center;
    background-color: rgb(213 172 96);
    border-top-right-radius: 5pt;
    border-bottom-right-radius: 5pt;
    border-top-left-radius: 5pt;
    border-bottom-left-radius: 5pt;
    padding-left: 5pt;
    padding-right: 2pt;
    box-shadow: 2px 0px 2px white;
    border: 1pt solid white;
}


functionCall > name {
  background-color: rgb(213, 172, 96);
  display: inline-block;
  padding:4pt;
  
  margin:0;
  color:black;
}


functionCall > parameters {
    display: inline-block;
    border-left: 4pt solid #0f0909;
    padding: 2pt;
    border-radius: 10pt;
    border-right: 4pt solid #0f0909;
    padding-right: 4pt;
    padding-left: 4pt;
    background-color:#3a2773;
}

guiArea {
  display: grid;
  grid-template-columns: repeat(4, 56px);
  grid-auto-rows: 56px;
  gap: 8px;
  background: #222;
  padding: 20px;
  border-radius: 16px;
  box-shadow: 0 4px 24px #0008;
  justify-content: center;
  width: max-content;
}

guiArea button {
  font-family: monospace;
  font-size: 22px;
  border: none;
  border-radius: 5px;
  background: #444;
  color: #fff;
  box-shadow: 0 2px 4px #0006;
  cursor: pointer;
  transition: background 0.15s, transform 0.1s;
  width: 100%;
  height: 100%;
  outline: none;
  display: flex;
  align-items: center;
  justify-content: center;
  
}

guiArea button:hover {
  background: #ffb300;
  color: #222;
  transform: scale(1.07);
}

guiArea button[aria-label="clear"] {
  grid-column: span 4;
  background: #b71c1c;
  color: #fff;
  font-weight: bold;
}

    </style> </head> <body> 
        
        <style>
          /* Styling for the tab container and individual tabs */
          .tab-container {
    display: flex;
    border-bottom: 3pt solid #000000;
    
}
          .tab {
    margin-right: 5pt;
    padding: 2pt 6pt;
    cursor: pointer;
    background-color: #ba9248;
    
    border-bottom: none;
    border-top-left-radius: 5pt;
    border-top-right-radius: 5pt;

    border-top: 3pt solid rgb(151, 151, 151);
    border-left: 3pt solid gray;
    border-right: 3pt solid silver;
    border: 3pt solid darkgray;
    border-bottom:0;
}
.tab.active {
    background-color: #986300;
    font-weight: bold;
    color: #e4831f;
    font-style: oblique;
    border-top: 3pt solid rgb(114, 114, 114);
    border-left: 3pt solid rgb(93, 93, 93);
    border-right: 3pt solid rgb(142, 142, 142);
    border: 3pt solid #444;
    border-bottom: 0;
}

.function-container {
  padding-top: 2pt;
  
  transition: height 0.3s ease; /* Smooth height adjustment */
}

.selected {
  outline: 3pt solid #60fa63;
  background: #333 !important;
}

.key-command-header {
  font-size: 18px;
  margin-bottom: 8px;
  color: #ffe082;
}

        </style>
        
        <script>

let currentlyHoveredElem = null;

document.addEventListener('mousemove', (e) => {
  // Find the closest code document element under the cursor
  const codeElem = e.target.closest('function, class, group, variable, statement, functionCall, parameter, codeBody');
  if (codeElem !== currentlyHoveredElem) {
    currentlyHoveredElem = codeElem;
    selectionDidChange();
  }
});


function selectionDidChange() {
  updateKeyCommandMenu(currentlyHoveredElem);
}


const tagBehaviors = {
  'function':      { hoverable: true, selectable: true, draggable: true },
  'class':         { hoverable: true, selectable: true, draggable: false },
  'group':         { hoverable: true, selectable: true, draggable: false },
  'variable':      { hoverable: true, selectable: true, draggable: false },
  'statement':     { hoverable: true, selectable: true, draggable: false },
  'functioncall':  { hoverable: true, selectable: true, draggable: false },
  'parameter':     { hoverable: true, selectable: false, draggable: false },
  'codebody':      { hoverable: false, selectable: false, draggable: false }
  
  // Add more as needed
};

function getTagBehaviors(elem) {
  if (!elem) return {};
  const tag = elem.tagName ? elem.tagName.toLowerCase() : elem.nodeName.toLowerCase();
  return tagBehaviors[tag] || {};
}


document.addEventListener('keydown', (e) => {
    // Ignore if any modifier key is pressed (Cmd, Ctrl, Alt, Shift)
    if (e.metaKey || e.ctrlKey || e.altKey || e.shiftKey) return;

// Escape key should always work, even if not hovering
if (e.key.toLowerCase() === 'escape') {
  const selected = document.querySelectorAll('.selected');
  if (selected.length) {
    selected.forEach(sel => sel.classList.remove('selected'));
    selectionDidChange();

  }
  return;
}

if (!currentlyHoveredElem) return;

  switch (e.key.toLowerCase()) {
    case 'd':
      // Collapse/Expand
      if (currentlyHoveredElem.matches('function')) {
        const codeBody = currentlyHoveredElem.querySelector('codeBody');
        if (codeBody) {
          const isCollapsed = codeBody.style.display === 'none';
          codeBody.style.display = isCollapsed ? 'block' : 'none';
        }
      }
      break;
      case 'f':
  clearSelectionsNotAtSameLevel(currentlyHoveredElem);
  currentlyHoveredElem.classList.toggle('selected');
  selectionDidChange();
  // (add drag-lock logic if needed)
  break;
    case 'e':
      // Insert code element (implement insertion logic here)
      alert('Insert code element (not implemented)');
      break;
    case 'r':
      // Edit name/label
      const nameElem = currentlyHoveredElem.querySelector(':scope > name');
      if (nameElem) {
        const newName = prompt('Edit name/label:', nameElem.textContent.trim());
        if (newName !== null) nameElem.textContent = newName;
      }
      break;
    case 'backspace':
      // Delete
      currentlyHoveredElem.remove();
      break;
      case 'tab':
  e.preventDefault();
  const behaviors = getTagBehaviors(currentlyHoveredElem);
  // Check if cursor is over a selectable element
  if (behaviors.selectable) {
    clearSelectionsNotAtSameLevel(currentlyHoveredElem);
    currentlyHoveredElem.classList.toggle('selected');
    selectionDidChange();
  } else {
    // If the cursor is over the codeDocument (but not a selectable element), clear selection
    const codeDoc = document.querySelector('codeDocument');
    if (codeDoc && codeDoc.contains(e.target)) {
      document.querySelectorAll('.selected').forEach(sel => sel.classList.remove('selected'));
      selectionDidChange();
    }
  }
  break;
    case 'g':
      // Group/Ungroup (implement logic here)
      alert('Group/Ungroup (not implemented)');
      break;
    case 'v':
      // Change view (implement logic here)
      alert('Change view (not implemented)');
      break;
      case 'escape':
  // Deselect all if there is a selection
  if (document.querySelector('.selected')) {
    document.querySelectorAll('.selected').forEach(sel => sel.classList.remove('selected'));
  }
  break;
    }
});


function clearSelectionsNotAtSameLevel(targetElem) {
  if (!targetElem) return;
  // Get the parent node of the target element
  const parent = targetElem.parentElement;
  // Deselect all .selected elements that do NOT share the same parent
  document.querySelectorAll('.selected').forEach(sel => {
    if (sel.parentElement !== parent) {
      sel.classList.remove('selected');
    }
  });
}

function updateKeyCommandMenu(elem) {
  const list = document.getElementById('key-command-list');
  const menu = document.getElementById('key-command-menu');
  menu.querySelector('.key-command-persistent')?.remove();

  const behaviors = getTagBehaviors(elem);

  if (!elem || !behaviors.hoverable) {
    list.innerHTML = "<em>Hover over a code element</em>";
    menu.querySelector('.key-command-header')?.remove();
    addPersistentMenuArea();
    return;
  }

  // Get tag and name (if present)
  const tag = elem.tagName ? elem.tagName.toLowerCase() : elem.nodeName.toLowerCase();
  let name = elem.querySelector('name') ? elem.querySelector('name').textContent.trim() : '';
  if (name) name = `: <b>${name}</b>`;

  // Insert header with tag and name
  menu.querySelector('.key-command-header')?.remove();
  const header = document.createElement('div');
  header.className = 'key-command-header';
  header.style = "font-weight:bold; margin-bottom:8px; color:#ffe082;";
  header.innerHTML = `&lt;${tag}&gt;${name}`;
  menu.insertBefore(header, menu.children[1]);

  // Build commands based on behaviors
  let commands = [];
  if (behaviors.selectable) {
    commands.push("<b>Tab</b> - Select");
    commands.push("<b>F</b> - Select &amp; Drag-lock");
  }
  if (behaviors.draggable) {
    commands.push("<b>F</b> - Drag-lock");
  }
  commands.push("<b>D</b> - Collapse/Expand");
  commands.push("<b>E</b> - Insert code element");
  commands.push("<b>R</b> - Edit name/label");
  commands.push("<b>Backspace</b> - Delete");
  commands.push("<b>G</b> - Group/Ungroup");
  commands.push("<b>V</b> - Change view");

  list.innerHTML = commands.join("<br>");

  addPersistentMenuArea();

  function addPersistentMenuArea()
{
 // Add persistent command at the bottom if something is selected
 const selected = document.querySelectorAll('.selected');
  if (selected.length) {
    const persistent = document.createElement('div');
    persistent.className = 'key-command-persistent';
    persistent.style = "margin-top:14px; color:#ffe082; font-weight:bold; border-top:1px solid #444; padding-top:8px;";
    persistent.innerHTML = `<b>Esc</b> - Deselect All (${selected.length} selected)`;
    menu.appendChild(persistent);
  }
}

}


document.addEventListener('DOMContentLoaded', () => {
  document.querySelectorAll('function').forEach(funcElem => {
    const nameElem = funcElem.querySelector(':scope > name');
    if (!nameElem) return; // Skip if there's no name

    // Create a NEW SVG arrow for each function
    const svgNS = "http://www.w3.org/2000/svg";
    const arrow = document.createElementNS(svgNS, 'svg');
    arrow.setAttribute('width', '24');
    arrow.setAttribute('height', '24');
    arrow.setAttribute('viewBox', '0 0 16 16');
    arrow.style.transition = 'transform 0.3s ease';
    arrow.style.marginLeft = '8px';
    arrow.style.verticalAlign = 'middle';

    const path = document.createElementNS(svgNS, 'path');
    path.setAttribute('d', 'M6 4l4 4-4 4z');
    path.setAttribute('fill', '#000');
    arrow.appendChild(path);

    const codeBody = funcElem.querySelector('codeBody');
    if (funcElem.getAttribute('collapsed') === 'true') {
      arrow.style.transform = 'rotate(180deg)';
      if (codeBody) codeBody.style.display = 'none';
    } else {
      arrow.style.transform = 'rotate(90deg)';
    }

    nameElem.appendChild(arrow);

    nameElem.addEventListener('click', () => {
      if (!codeBody) return;
      if (codeBody.style.display === 'none') {
        codeBody.style.display = 'block';
        arrow.style.transform = 'rotate(90deg)';
        funcElem.setAttribute('collapsed', 'false');
      } else {
        codeBody.style.display = 'none';
        arrow.style.transform = 'rotate(180deg)';
        funcElem.setAttribute('collapsed', 'true');
      }
      documentUIDidChange
    });
  });
});
          // Function to adjust the height of the function-container to match the tallest <function> element.
  function adjustFunctionContainerHeight(functionContainer) {
  //console.log("adjustFunctionContainerHeight called for:", functionContainer);
  // Query for all <function> elements inside the functionContainer.
  const functions = functionContainer.querySelectorAll('function');
  //console.log("Number of <function> elements found:", functions.length);
  let maxHeight = 0;
  
  functions.forEach(funcElem => {
    // Log the current computed display for the <function> element.
    const currentDisplay = window.getComputedStyle(funcElem).display;
    //console.log("Current display for function:", currentDisplay, funcElem);
    
    // Temporarily force the function element to be visible for measurement.
    funcElem.style.display = 'block';
    funcElem.style.visibility = 'hidden';
    funcElem.style.position = 'absolute';
    
    // Use scrollHeight to capture the full height of the <function> element.
    const height = funcElem.scrollHeight;
    //console.log("Measured height for function using scrollHeight:", height, funcElem);
    if (height > maxHeight) {
      maxHeight = height;
    }
    
    // Restore the original display state.
    if (currentDisplay === 'none') {
      funcElem.style.display = 'none';
      //console.log("Restored display to 'none' for function:", funcElem);
    } else {
      funcElem.style.display = '';
    }
    funcElem.style.visibility = '';
    funcElem.style.position = '';
  });
  
  //console.log("Tallest measured height:", maxHeight);
  functionContainer.style.height = `${maxHeight + 5}pt`;
}
document.addEventListener('DOMContentLoaded', () => {
  document.querySelectorAll('group[presentation="tabifyingView"]').forEach(group => {
    const functionContainer = group.querySelector('.function-container');
    if (functionContainer) {
      adjustFunctionContainerHeight(functionContainer);
    }
  });
});

function documentUIDidChange() {
  
  document.querySelectorAll('group[presentation="tabifyingView"]').forEach(group => {
    const functionContainer = group.querySelector('.function-container');
    if (functionContainer) {
      adjustFunctionContainerHeight(functionContainer);
    }
  });
}

       document.addEventListener('DOMContentLoaded', () => {
  // Observe changes to the codeDocument element: trigger documentDidChange on mutations.
  const codeDoc = document.querySelector('codeDocument');
  if (codeDoc) {
    const observer = new MutationObserver(() => {
      documentUIDidChange();
      });
    observer.observe(codeDoc, { childList: true, subtree: true, characterData: true });
  }

  

  // Process each group element that should use the tabifyingView presentation.
  document.querySelectorAll('group[presentation="tabifyingView"]').forEach(group => {
    // Gather all immediate function children in the group.
    const functions = group.querySelectorAll(':scope > function');
    if (functions.length > 0) {
      // Create a container to hold the tabs.
      const tabContainer = document.createElement('div');
      tabContainer.className = 'tab-container';

      // Create a container to hold the function views.
      const functionContainer = document.createElement('div');
      functionContainer.className = 'function-container';

      // Create a tab for each function.
      functions.forEach((funcElem, index) => {
        const tab = document.createElement('div');
        tab.className = 'tab';
        // Use the text from the <name> element as the tab label. Fallback if not found.
        const nameElem = funcElem.querySelector(':scope > name');
        tab.textContent = (nameElem && nameElem.textContent.trim()) || `Function ${index + 1}`;
        tab.dataset.index = index;

        // Wrap the function in a separate container.
        const funcWrapper = document.createElement('div');
        funcWrapper.className = 'function-wrapper';
        funcWrapper.style.display = index === 0 ? 'block' : 'none'; // Show only the first function by default.
        funcWrapper.appendChild(funcElem);

        // Add the function wrapper to the function container.
        functionContainer.appendChild(funcWrapper);

        // Activate the corresponding function on hover.
        tab.addEventListener('mouseover', () => {
          // Hide all function wrappers.
          functionContainer.querySelectorAll('.function-wrapper').forEach(wrapper => {
            wrapper.style.display = 'none';
          });

          // Show the selected function wrapper.
          funcWrapper.style.display = 'block';

          // Update the active tab style.
          tabContainer.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
          tab.classList.add('active');

          documentUIDidChange();
        });

        tabContainer.appendChild(tab);
      });

      // Insert the tab container and function container into the group.
      group.insertBefore(tabContainer, group.firstChild);
      group.appendChild(functionContainer);

       // On page load, set the first tab as active.
       const firstTab = tabContainer.querySelector('.tab');
      if (firstTab) {
        firstTab.classList.add('active');
      }

      
    }
  });
});



        </script>

        <codeDocument>
    
         

    <!-- Class Demo: A Calculator class with methods -->
    <class>
      <name>Calculator</name>
      <documentation>A simple calculator class with add and subtract methods.</documentation>

      <statement>
        <variable>
          <typeSymbol>#</typeSymbol>
          <name>currentValue</name>
        </variable>
      </statement>
      
      <!-- Constructor (init function) -->
     <constructors>
      <function collapsed="true">
        <role>
          <roleSymbol>c</roleSymbol>
          <roleType>constructor</roleType>
        </role>
        <parameters>
          <parameter>
            <type>
              <typeSymbol>#</typeSymbol>
              <typeName>int</typeName>
            </type>
            <name>initialDisplayValue</name>
          </parameter>
        </parameters>
        <name>init</name>
        <documentation>Initializes the calculator with an initial value.</documentation>
        <codeBody>
          <statement>
            <expression>
              <variable>
                <typeSymbol>#</typeSymbol>
                <name>currentValue</name>
              </variable> = 
              <expression>
                <functionCall>
                  <typeSymbol>ℱ</typeSymbol>
                  <name>getInitialValue</name>
                  <parameters></parameters>
                </functionCall>
              </expression>
            </expression>
          </statement>
        </codeBody>
      </function>
    </constructors>
    
      <group presentation="tabifyingView">
        <!-- Function Demo: Parameters appear above the function name with type symbols -->
        <function>
          <parameters>
            <parameter>
              <type>
                <typeSymbol>#</typeSymbol>
                <typeName>int</typeName>
              </type>
              <name>a</name>
            </parameter>
            <parameter>
              <type>
                <typeSymbol>#</typeSymbol>
                <typeName>int</typeName>
              </type>
              <name>b</name>
            </parameter>
          </parameters>
          
          <name>sum <return-type>#</return-type></name>
          
            
    
          <documentation>Returns the sum of two integers.</documentation>
          <codeBody>
            <statement>
                
            <return>
              <name>return</name>
              <expression><variable>
                <type>
                  <typeSymbol>#</typeSymbol>
                  <typeName>int</typeName>
                </type>            
                <name>a</name>
              </variable> + <variable>
                <type>
                  <typeSymbol>#</typeSymbol>
                  <typeName>int</typeName>
                </type>            
                <name>b</name>
              </variable></expression>
              
            </return>
          </statement>
          </codeBody>
        </function>
        <function>
          <parameters>
            <parameter>
              <type>
                <typeSymbol>#</typeSymbol>
                <typeName>int</typeName>
              </type>
              <name>a</name>
            </parameter>
            <parameter>
              <type>
                <typeSymbol>#</typeSymbol>
                <typeName>int</typeName>
              </type>
              <name>b</name>
            </parameter>
          </parameters>
          <name>product</name>
          <documentation>Returns the sum of two integers.</documentation>
          <return-type>#</return-type>
          <codeBody>
            <statement>
              <return>
                <name>return</name>
                <expression>
                  <variable>
                    <type>
                      <typeSymbol>#</typeSymbol>
                      <typeName>int</typeName>
                    </type>
                    <name>a</name>
                  </variable> 
                  <operation>*</operation> 
                  <variable>
                    <type>
                      <typeSymbol>#</typeSymbol>
                      <typeName>int</typeName>
                    </type>
                    <name>b</name>
                  </variable>
                </expression>
              </return>
            </statement>
          </codeBody>
        </function>
        <function>
          <parameters>
            <parameter>
              <type>
                <typeSymbol>#</typeSymbol>
                <typeName>int</typeName>
              </type>
              <name>a</name>
            </parameter>
            <parameter>
              <type>
                <typeSymbol>#</typeSymbol>
                <typeName>int</typeName>
              </type>
              <name>b</name>
            </parameter>
          </parameters>
          <name>quotient</name>
          <documentation>Returns the sum of two integers.</documentation>
          <return-type>#</return-type>
          <codeBody>
            <statement>
              <return>
                <name>return</name>
                <expression>
                  <variable>
                    <type>
                      <typeSymbol>#</typeSymbol>
                      <typeName>int</typeName>
                    </type>
                    <name>a</name>
                  </variable> 
                  <operation>/</operation> 
                  <variable>
                    <type>
                      <typeSymbol>#</typeSymbol>
                      <typeName>int</typeName>
                    </type>
                    <name>b</name>
                  </variable>
                </expression>
              </return>
            </statement>
          </codeBody>
        </function>
      
        <function>
          <parameters>
            <parameter>
              <type>
                <typeSymbol>#</typeSymbol>
                <typeName>int</typeName>
              </type>
              <name>x</name>
            </parameter>
            <parameter>
              <type>
                <typeSymbol>#</typeSymbol>
                <typeName>int</typeName>
              </type>
              <name>y</name>
            </parameter>
          </parameters>
          <name>difference</name>
          <documentation>subtracts one number from the other.</documentation>
          <return-type>#</return-type>
          <codeBody>
            <statement>
              <return>
                <name>return</name>
                <expression>
                  <variable>
                    <type>
                      <typeSymbol>#</typeSymbol>
                      <typeName>int</typeName>
                    </type>
                    <name>x</name>
                  </variable> 
                  <operation>-</operation> 
                  <variable>
                    <type>
                      <typeSymbol>#</typeSymbol>
                      <typeName>int</typeName>
                    </type>
                    <name>y</name>
                  </variable>
                </expression>
              </return>
            </statement>
          </codeBody>
        </function>
   

      </group>
      <!-- Existing methods -->


    
  <!-- Loop Demo: A function containing a loop -->
  <function collapsed="true">
    <parameters></parameters>
    <name>printNumbers</name>
    <return-type>∅</return-type>
    <documentation>Prints numbers from 0 to 9.</documentation>
    
    <codeBody>
      <loop>
        <initialization>
          <variable>
            <typeSymbol>#</typeSymbol>
            <name>i</name>
          </variable>
          <expression>= 0</expression>
        </initialization>
        <condition>
          <expression>i &lt; 10</expression>
        </condition>
        <increment>
          <expression>i++</expression>
        </increment>
        <codeBody>
          <statement>
            <expression>print(i)</expression>
          </statement>
        </codeBody>
      </loop>
    </codeBody>
  </function>
  
          <!-- Function Demo: Supports float and string parameters with distinct symbols -->
          <function collapsed="true">
            <parameters>
              <parameter>
                <type>
                  <typeSymbol>#.</typeSymbol>
                  <typeName>float</typeName>
                </type>
                <name>xLocation</name>
              </parameter>
              
              <parameter>
                <type>
                  <typeSymbol>#.</typeSymbol>
                  <typeName>float</typeName>
                </type>
                <name>yLocation</name>
              </parameter>
              
              <parameter>
                <type>
                  <typeSymbol>$</typeSymbol>
                  <typeName>string</typeName>
                </type>
                <name>labelForUI</name>
              </parameter>


            </parameters>
            <name>updateDisplay       <return-type>∅</return-type>      </name>
            <documentation>Updates the UI element's position and label.</documentation>
            <codeBody>
              <statement>
                <expression>
                <functionCall>
                  <typeSymbol>ℱ</typeSymbol>
                  <name>setPosition</name>
                  <parameters>
                    <parameter>
                      <type>
                        <typeSymbol>#.</typeSymbol>
                        <typeName>float</typeName>
                      </type>
                      <name>xLocation</name>
                    </parameter>
                    <parameter>
                      <type>
                        <typeSymbol>#.</typeSymbol>
                        <typeName>float</typeName>
                      </type>
                      <name>yLocation</name>
                    </parameter>
                    
                    
                  </parameters>
                </functionCall>
                </expression>
              </statement>
              
              <statement>
                <expression>
                  <functionCall>
                    <typeSymbol>ℱ</typeSymbol>
                    <name>setLabel</name>
                    <parameters>
                      <parameter>
                        <typeSymbol>$</typeSymbol>
                        <typeName>string</typeName>
                        <name>labelForUI</name>
                      </parameter>
                    </parameters>
                  </functionCall>
                  </expression>
              </statement>
              <statement>
                <expression>
                  <functionCall>
                    <typeSymbol>ℱ</typeSymbol>
                    <name>setBackgroundColor</name>
                    <parameters>
                      <parameter>
                        <type>
                          <typeSymbol>$</typeSymbol>
                          <typeName>string</typeName>
                        </type>
                        <name>color</name>
                      </parameter>
                    </parameters>
                  </functionCall>
                </expression>
              </statement>
              
              <statement>
                <expression>
                  <functionCall>
                    <typeSymbol>ℱ</typeSymbol>
                    <name>setBorder</name>
                    <parameters>
                      <parameter>
                        <type>
                          <typeSymbol>#</typeSymbol>
                          <typeName>int</typeName>
                        </type>
                        <name>width</name>
                      </parameter>
                      <parameter>
                        <type>
                          <typeSymbol>$</typeSymbol>
                          <typeName>string</typeName>
                        </type>
                        <name>style</name>
                      </parameter>
                      <parameter>
                        <type>
                          <typeSymbol>$</typeSymbol>
                          <typeName>string</typeName>
                        </type>
                        <name>color</name>
                      </parameter>
                    </parameters>
                  </functionCall>
                </expression>
              </statement>
              
              <statement>
                <expression>
                  <functionCall>
                    <typeSymbol>ℱ</typeSymbol>
                    <name>setOpacity</name>
                    <parameters>
                      <parameter>
                        <type>
                          <typeSymbol>#.</typeSymbol>
                          <typeName>float</typeName>
                        </type>
                        <name>opacityLevel</name>
                      </parameter>
                    </parameters>
                  </functionCall>
                </expression>
              </statement>
              
              <statement>
                <expression>
                  <functionCall>
                    <typeSymbol>ℱ</typeSymbol>
                    <name>setFontSize</name>
                    <parameters>
                      <parameter>
                        <type>
                          <typeSymbol>#</typeSymbol>
                          <typeName>int</typeName>
                        </type>
                        <name>size</name>
                      </parameter>
                    </parameters>
                  </functionCall>
                </expression>
              </statement>
            </codeBody>
          </function>
          
          <variable>
            <name>buttons</name>
            <typeSymbol>guiArea</typeSymbol>
            <documentation>Calculator button layout and labels.</documentation>
            <guiArea>
              <button>7</button>
              <button>8</button>
              <button>9</button>
              <button>÷</button>
              <button>4</button>
              <button>5</button>
              <button>6</button>
              <button>×</button>
              <button>1</button>
              <button>2</button>
              <button>3</button>
              <button>−</button>
              <button>0</button>
              <button>.</button>
              <button>=</button>
              <button>+</button>
              <button aria-label="clear">C</button>
            </guiArea>
          </variable>
    </class>

    <statement>
    <!-- Standalone Variable Declaration Demo -->
    <variable>
        <documentation>An integer variable used to index lists.</documentation>
        <typeSymbol>#</typeSymbol>
      <name>indexOfList</name>
      
    </variable>
  </statement>

  <div id="key-command-menu" style="
  position: fixed;
  right: 24px;
  bottom: 24px;
  background: #222;
  color: #fff;
  border-radius: 12px;
  box-shadow: 0 4px 24px #0008;
  padding: 18px 24px;
  font-family: monospace;
  font-size: 16px;
  z-index: 10000;
  min-width: 260px;
  opacity: 0.95;
">
  <div style="font-weight:bold; margin-bottom:8px;">Key Commands</div>
  <div id="key-command-list"></div>
</div>
</codeDocument> 
    
    
    <script> // Enable interactive toggling: clicking on a function or method name expands/collapses the code body. document.querySelectorAll('function > name, method > name').forEach(elem => { elem.addEventListener('click', () => { const parent = elem.parentElement; parent.classList.toggle('expanded'); }); }); </script> </body> </html>